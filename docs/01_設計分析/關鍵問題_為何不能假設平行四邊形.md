# é—œéµè¨­è¨ˆå•é¡Œï¼šç‚ºä½•ä¸èƒ½ç›´æ¥å‡è¨­å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹ï¼Ÿ

## ğŸ¯ ä½ çš„è³ªç–‘å®Œå…¨æ­£ç¢ºï¼

ä½ æå‡ºäº†ä¸€å€‹éå¸¸é‡è¦çš„å•é¡Œï¼š

> **ç‚ºä»€éº¼ä¸€é–‹å§‹å°±å‡è¨­å…©å€‹ L2 å¹³è¡Œï¼Œä»¥åŠ Oâ‚‚-Oâ‚„ å¹³è¡Œï¼Ÿ**
> **æˆ‘å€‘æ€éº¼çŸ¥é“å®ƒä¸€å®šæ˜¯å¹³è¡Œå››é‚Šå½¢ï¼Ÿ**

**ç­”æ¡ˆï¼šæˆ‘å€‘ä¸çŸ¥é“ï¼Œä¹Ÿä¸æ‡‰è©²å‡è¨­ï¼**

é€™æ˜¯æˆ‘åœ¨ã€Œæ­¥é©Ÿ1ã€ä¸­çŠ¯çš„ä¸€å€‹**è¨­è¨ˆæ–¹æ³•è«–éŒ¯èª¤**ã€‚è®“æˆ‘å®Œæ•´è§£é‡‹é€™å€‹å•é¡Œã€‚

---

## 1. å•é¡Œåˆ†æ

### 1.1 é¡Œç›®å¯¦éš›è¦æ±‚

é¡Œç›®èªªï¼š
> è¨­è¨ˆä¸€å€‹ä½¿ç”¨**å››é€£æ¡¿æ©Ÿæ§‹**ï¼ˆfour-bar mechanismï¼‰çš„ä¸‹æ‹‰å¼å±¤æ¶

**é¡Œç›®ä¸¦æ²’æœ‰èªª**ï¼š
- âŒ å¿…é ˆæ˜¯å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹
- âŒ å±¤æ¶å¿…é ˆä¿æŒæ°´å¹³
- âŒ é€£æ¡¿é•·åº¦å¿…é ˆç›¸ç­‰

**é¡Œç›®åªèªª**ï¼š
- âœ… æ˜¯å››é€£æ¡¿æ©Ÿæ§‹ï¼ˆ4å€‹æ¡¿ï¼Œ4å€‹æ¨è»¸ï¼‰
- âœ… ä¸‹é™è‡³å°‘30 cm
- âœ… åˆå§‹ç‹€æ…‹åœ¨æ«ƒå…§

### 1.2 æˆ‘ç‚ºä»€éº¼å‡è¨­å¹³è¡Œå››é‚Šå½¢ï¼Ÿ

**ç†ç”±1ï¼šæ‰‹ç¨¿çš„æš—ç¤º**

æ‰‹ç¨¿ä¸­å¯«ï¼š
> "Link 4's overall orientation remains the same"
> ï¼ˆé€£æ¡¿4çš„å§¿æ…‹ä¿æŒä¸è®Šï¼‰

æˆ‘ç†è§£æˆï¼šå±¤æ¶éœ€è¦ä¿æŒæ°´å¹³ã€‚

**ç†ç”±2ï¼šè¨­è¨ˆç°¡åŒ–**

å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹æ˜¯æœ€ç°¡å–®çš„ä¿è­‰å§¿æ…‹ä¸è®Šçš„æ–¹æ³•ã€‚

**ç†ç”±3ï¼šå¿«é€Ÿå…¥é–€**

ä½œç‚º"æ­¥é©Ÿ1"çš„åŸºç¤æ–¹æ¡ˆï¼Œå¹³è¡Œå››é‚Šå½¢å®¹æ˜“è¨ˆç®—ã€‚

### 1.3 å•é¡Œåœ¨å“ªè£¡ï¼Ÿ

**é€™äº›ç†ç”±éƒ½ä¸å¤ å……åˆ†ï¼**

1. **æ‰‹ç¨¿å¯èƒ½æ˜¯éŒ¯çš„**
   - æ‰‹ç¨¿æœ¬èº«å°±æœ‰å•é¡Œï¼ˆæˆ‘åœ¨ã€Œè§£é¡Œæµç¨‹ã€ä¸­åˆ†æéï¼‰
   - å§¿æ…‹ä¸è®Šå¯èƒ½åªæ˜¯ä¸€å€‹ç°¡åŒ–å‡è¨­ï¼Œä¸æ˜¯å¿…è¦æ¢ä»¶

2. **é¡Œç›®æ²’æœ‰è¦æ±‚ä¿æŒæ°´å¹³**
   - å±¤æ¶ç¨å¾®å‚¾æ–œä¹Ÿå¯ä»¥ï¼ˆåªè¦ä¸å¤ªèª‡å¼µï¼‰
   - ç”šè‡³å‚¾æ–œå¯èƒ½æœ‰å„ªé»ï¼ˆç‰©å“ä¸æœƒæ»‘å‹•ï¼‰

3. **é™åˆ¶äº†è¨­è¨ˆç©ºé–“**
   - å¹³è¡Œå››é‚Šå½¢åªæ˜¯ç„¡çª®å¤šç¨®å››é€£æ¡¿æ©Ÿæ§‹çš„ä¸€å€‹ç‰¹ä¾‹
   - å¯èƒ½å­˜åœ¨æ›´å¥½çš„éå¹³è¡Œå››é‚Šå½¢è¨­è¨ˆ

---

## 2. æ­£ç¢ºçš„è¨­è¨ˆæµç¨‹æ‡‰è©²æ˜¯ä»€éº¼ï¼Ÿ

### 2.1 ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹çš„å®Œæ•´æ–¹æ³•

#### æ¨™æº–çš„æ©Ÿæ§‹åˆæˆå•é¡Œ

å°æ–¼å››é€£æ¡¿æ©Ÿæ§‹ $O_2-A-B-O_4$ï¼š

**çµ¦å®š**ï¼š
- åˆå§‹ä½ç½® Pâ‚ï¼šå±¤æ¶çš„ä½ç½®å’Œå§¿æ…‹ $(x_1, y_1, \theta_1)$
- æœ€çµ‚ä½ç½® Pâ‚‚ï¼šå±¤æ¶çš„ä½ç½®å’Œå§¿æ…‹ $(x_2, y_2, \theta_2)$
- ï¼ˆå¯é¸ï¼‰ä¸­é–“ä½ç½® Pâ‚ƒ

**æ±‚è§£**ï¼š
- å››å€‹é€£æ¡¿é•·åº¦ï¼š$L_1, L_2, L_3, L_4$
- å›ºå®šæ¨è»¸ä½ç½®ï¼š$O_2, O_4$

#### å‘é‡è¿´è·¯æ–¹ç¨‹å¼ï¼ˆæ­£ç¢ºç‰ˆæœ¬ï¼‰

$$
\vec{R}_2 + \vec{L}_2 + \vec{L}_3 = \vec{R}_4 + \vec{L}_4
$$

å…¶ä¸­ï¼š
- $\vec{R}_2$ï¼šå¾åŸé»åˆ° $O_2$ çš„å‘é‡ï¼ˆå›ºå®šï¼‰
- $\vec{L}_2$ï¼šå¾ $O_2$ åˆ° A çš„é€£æ¡¿å‘é‡ï¼ˆè®ŠåŒ–ï¼‰
- $\vec{L}_3$ï¼šå¾ A åˆ° B çš„é€£æ¡¿å‘é‡ï¼ˆcouplerï¼‰
- $\vec{L}_4$ï¼šå¾ $O_4$ åˆ° B çš„é€£æ¡¿å‘é‡ï¼ˆè®ŠåŒ–ï¼‰
- $\vec{R}_4$ï¼šå¾åŸé»åˆ° $O_4$ çš„å‘é‡ï¼ˆå›ºå®šï¼‰

**é—œéµ**ï¼š
- $|\vec{L}_2|, |\vec{L}_3|, |\vec{L}_4|$ éƒ½æ˜¯å¸¸æ•¸ï¼ˆé€£æ¡¿é•·åº¦ä¸è®Šï¼‰
- ä½†å®ƒå€‘çš„é•·åº¦**ä¸ä¸€å®šç›¸ç­‰**
- æ–¹å‘æœƒéš¨è‘—é‹å‹•æ”¹è®Š

#### è¤‡æ•¸å½¢å¼ï¼ˆæ›´åš´è¬¹ï¼‰

ç”¨è¤‡æ•¸è¡¨ç¤ºå¹³é¢å‘é‡ï¼š

$$
r_2 + L_2 e^{i\theta_2} + L_3 e^{i\phi} = r_4 + L_4 e^{i\theta_4}
$$

å…¶ä¸­ï¼š
- $L_2, L_3, L_4$ï¼šé€£æ¡¿é•·åº¦ï¼ˆæœªçŸ¥ï¼‰
- $\theta_2, \theta_4$ï¼šé©…å‹•è§’å’Œå¾å‹•è§’ï¼ˆéš¨æ™‚é–“è®ŠåŒ–ï¼‰
- $\phi$ï¼šcoupler çš„å§¿æ…‹è§’ï¼ˆéš¨æ™‚é–“è®ŠåŒ–ï¼‰

**å°æ–¼å…©å€‹ä½ç½®ï¼ˆj=1, 2ï¼‰**ï¼š

$$
\begin{cases}
r_2 + L_2 e^{i\theta_2^{(1)}} + L_3 e^{i\phi^{(1)}} = r_4 + L_4 e^{i\theta_4^{(1)}} \\
r_2 + L_2 e^{i\theta_2^{(2)}} + L_3 e^{i\phi^{(2)}} = r_4 + L_4 e^{i\theta_4^{(2)}}
\end{cases}
$$

é€™æ˜¯ **2å€‹è¤‡æ•¸æ–¹ç¨‹å¼ = 4å€‹å¯¦æ•¸æ–¹ç¨‹å¼**ã€‚

**æœªçŸ¥æ•¸æœ‰å¤šå°‘å€‹ï¼Ÿ**

- $L_2, L_3, L_4$ï¼ˆ3å€‹ï¼‰
- $r_2 = (x_{O_2}, y_{O_2})$ï¼ˆ2å€‹ï¼‰
- $r_4 = (x_{O_4}, y_{O_4})$ï¼ˆ2å€‹ï¼‰
- $\theta_2^{(1)}, \theta_2^{(2)}, \theta_4^{(1)}, \theta_4^{(2)}$ï¼ˆ4å€‹ï¼‰
- $\phi^{(1)}, \phi^{(2)}$ï¼ˆ2å€‹ï¼‰

**ç¸½å…± 13 å€‹æœªçŸ¥æ•¸ï¼ä½†åªæœ‰ 4 å€‹æ–¹ç¨‹å¼ï¼**

é€™æ„å‘³è‘—ï¼š**è‡ªç”±åº¦å¤ªå¤šï¼Œæœ‰ç„¡çª®å¤šè§£ï¼**

### 2.2 å¦‚ä½•æ¸›å°‘è‡ªç”±åº¦ï¼Ÿ

#### ç­–ç•¥ Aï¼šæŒ‡å®šå›ºå®šæ¨è»¸ä½ç½®

**å‡è¨­**ï¼šæˆ‘å€‘é å…ˆé¸å®š $O_2$ å’Œ $O_4$ çš„ä½ç½®ã€‚

- é€™æ¸›å°‘äº† 4 å€‹æœªçŸ¥æ•¸ï¼ˆ$x_{O_2}, y_{O_2}, x_{O_4}, y_{O_4}$ï¼‰
- å‰©ä¸‹ 9 å€‹æœªçŸ¥æ•¸ï¼Œ4 å€‹æ–¹ç¨‹å¼
- **ä»ç„¶æœ‰ 5 å€‹è‡ªç”±åº¦**

#### ç­–ç•¥ Bï¼šæŒ‡å®šå±¤æ¶å§¿æ…‹

**å‡è¨­**ï¼šæˆ‘å€‘è¦æ±‚å±¤æ¶ä¿æŒæ°´å¹³ï¼ˆ$\phi^{(1)} = \phi^{(2)} = 0$ï¼‰ã€‚

- é€™æ¸›å°‘äº† 2 å€‹æœªçŸ¥æ•¸
- ä½†ä»ç„¶è‡ªç”±åº¦éå¤š

#### ç­–ç•¥ Cï¼šæŒ‡å®šé€£æ¡¿é•·åº¦é—œä¿‚

**å‡è¨­**ï¼šæŸäº›é€£æ¡¿é•·åº¦ç›¸ç­‰ã€‚

ä¾‹å¦‚ï¼š
- $L_2 = L_4$ ä¸” $L_1 = L_3$ï¼ˆå¹³è¡Œå››é‚Šå½¢ï¼‰
- é€™æ¸›å°‘äº† 2 å€‹æœªçŸ¥æ•¸

#### å®Œæ•´çš„ã€ŒæŒ‡å®šå›ºå®šæ¨è»¸åˆæˆæ³•ã€

**æ–¹æ³•**ï¼šåŒæ™‚ä½¿ç”¨ç­–ç•¥ A å’Œ B

1. **æŒ‡å®š $O_2$ å’Œ $O_4$ çš„ä½ç½®**ï¼ˆæ ¹æ“šç¶“é©—æˆ–å°ç¨±æ€§ï¼‰
2. **æŒ‡å®šå±¤æ¶å§¿æ…‹**ï¼ˆå¦‚ä¿æŒæ°´å¹³ï¼š$\phi = \text{const}$ï¼‰
3. **æŒ‡å®šåˆå§‹å’Œæœ€çµ‚ä½ç½®**ï¼ˆ$P_1, P_2$ï¼‰

é€™æ¨£ï¼ŒæœªçŸ¥æ•¸æ¸›å°‘åˆ°ï¼š
- $L_2, L_3, L_4$ï¼ˆ3å€‹ï¼‰
- $\theta_2^{(1)}, \theta_2^{(2)}, \theta_4^{(1)}, \theta_4^{(2)}$ï¼ˆ4å€‹ï¼‰

ç¸½å…± 7 å€‹æœªçŸ¥æ•¸ã€‚

å¦‚æœä½¿ç”¨**ä¸‰å€‹ä½ç½®**ï¼ˆ$P_1, P_2, P_3$ï¼‰ï¼š
- æ–¹ç¨‹å¼å¢åŠ åˆ° 6 å€‹ï¼ˆ3å€‹ä½ç½® Ã— 2å€‹å¯¦æ•¸æ–¹ç¨‹ï¼‰
- ä»ç„¶ç•¥æœ‰æ¬ å®šï¼ˆ7 > 6ï¼‰

å¦‚æœå†åŠ ä¸Š**å¹¾ä½•ç´„æŸ**ï¼ˆå¦‚æ ¼æ‹‰æ›‰å¤«å®šç†ï¼‰ï¼š
- å¯ä»¥å”¯ä¸€ç¢ºå®šè§£

---

## 3. å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹æ˜¯å¦åˆç†ï¼Ÿ

### 3.1 ä½•æ™‚å¹³è¡Œå››é‚Šå½¢æ˜¯å¥½é¸æ“‡ï¼Ÿ

**æƒ…æ³1ï¼šæ˜ç¢ºè¦æ±‚å±¤æ¶ä¿æŒæ°´å¹³**

å¦‚æœé¡Œç›®æˆ–ä½¿ç”¨è€…æ˜ç¢ºè¦æ±‚ï¼š
- âœ… å±¤æ¶å¿…é ˆæ°´å¹³ï¼ˆæ”¾ç½®æ¶²é«”ï¼‰
- âœ… ç‰©å“ä¸èƒ½å‚¾æ–œ
- é‚£éº¼å¹³è¡Œå››é‚Šå½¢æ˜¯æœ€ç°¡å–®çš„è§£

**æƒ…æ³2ï¼šä½œç‚ºåˆå§‹è¨­è¨ˆ**

- âœ… ä½œç‚ºã€Œæ­¥é©Ÿ1ã€çš„åŸºç¤æ–¹æ¡ˆ
- âœ… å¿«é€Ÿé©—è­‰å¯è¡Œæ€§
- âœ… å»ºç«‹è¨­è¨ˆç›´è¦º

**æƒ…æ³3ï¼šå°ç¨±ç¾å­¸**

- âœ… è¦–è¦ºä¸Šæ›´å°ç¨±ã€æ›´ç¾è§€
- âœ… ç¬¦åˆä½¿ç”¨è€…æœŸæœ›ï¼ˆçœ‹èµ·ä¾†ã€Œæ­£å¸¸ã€ï¼‰

### 3.2 ä½•æ™‚å¹³è¡Œå››é‚Šå½¢ä¸æ˜¯æœ€ä½³é¸æ“‡ï¼Ÿ

**æƒ…æ³1ï¼šéœ€è¦æœ€å¤§åŒ–å„²å­˜ç©ºé–“**

- éå¹³è¡Œå››é‚Šå½¢å¯èƒ½æœ‰æ›´å¤§çš„å„²å­˜ç©ºé–“
- ä¾‹å¦‚ï¼šå±¤æ¶ç¨å¾®å‚¾æ–œï¼Œä½†æ·±åº¦æ›´å¤§

**æƒ…æ³2ï¼šéœ€è¦ç‰¹æ®Šé‹å‹•è»Œè·¡**

- å¯èƒ½éœ€è¦æ›²æŸ„æ–æ¡¿æ©Ÿæ§‹
- æˆ–é›™æ–æ¡¿æ©Ÿæ§‹

**æƒ…æ³3ï¼šå„ªåŒ–å¤šå€‹ç›®æ¨™**

- ç•¶åŒæ™‚è€ƒæ…®æˆæœ¬ã€ç©ºé–“ã€é‹å‹•æ€§èƒ½æ™‚
- å¹³è¡Œå››é‚Šå½¢å¯èƒ½ä¸æ˜¯å¸•ç´¯æ‰˜æœ€å„ªè§£

---

## 4. æ›´æ­£ç¢ºçš„è¨­è¨ˆæµç¨‹

### 4.1 ç¬¬ä¸€éšæ®µï¼šæ¢ç´¢ï¼ˆä¸å‡è¨­å¹³è¡Œå››é‚Šå½¢ï¼‰

#### æ­¥é©Ÿ 1ï¼šå®šç¾©éœ€æ±‚

- åˆå§‹ä½ç½®ï¼š$(x_1, y_1, \theta_1)$
- æœ€çµ‚ä½ç½®ï¼š$(x_2, y_2, \theta_2)$
- ä¸‹é™è·é›¢ï¼š$\Delta h \geq 30$ cm

**ä¸å‡è¨­ $\theta_1 = \theta_2$**ï¼ˆå…è¨±å±¤æ¶å§¿æ…‹æ”¹è®Šï¼‰

#### æ­¥é©Ÿ 2ï¼šé¸æ“‡å›ºå®šæ¨è»¸ä½ç½®

æ ¹æ“šç¶“é©—æˆ–å°ç¨±æ€§ï¼Œé¸æ“‡ $O_2$ å’Œ $O_4$ã€‚

ä¾‹å¦‚ï¼š
- $O_2 = (10, 10)$ cm
- $O_4 = (10, 50)$ cm

#### æ­¥é©Ÿ 3ï¼šæ±‚è§£é€£æ¡¿é•·åº¦

ä½¿ç”¨ä¸‰ä½ç½®ç¶œåˆæ³•æˆ–æ•¸å€¼å„ªåŒ–ï¼Œæ±‚è§£ $L_2, L_3, L_4$ã€‚

**ç›®æ¨™**ï¼šæœ€å¤§åŒ–å„²å­˜ç©ºé–“

**ç´„æŸ**ï¼š
- ä¸‹é™è·é›¢ â‰¥ 30 cm
- ç„¡ç¢°æ’
- æ ¼æ‹‰æ›‰å¤«å®šç†ï¼ˆç¢ºä¿å¯é‹å‹•ï¼‰

#### æ­¥é©Ÿ 4ï¼šæª¢æŸ¥çµæœ

æ±‚è§£å¾Œï¼Œæª¢æŸ¥ï¼š
- $L_2 = L_4$ å—ï¼Ÿï¼ˆæ˜¯å¦ç¢°å·§æ˜¯å¹³è¡Œå››é‚Šå½¢ï¼Ÿï¼‰
- $\theta_1 \approx \theta_2$ å—ï¼Ÿï¼ˆå±¤æ¶æ˜¯å¦æ¥è¿‘æ°´å¹³ï¼Ÿï¼‰

**å¦‚æœæ˜¯**ï¼šé‚£éº¼å¹³è¡Œå››é‚Šå½¢ç¢ºå¯¦æ˜¯æœ€å„ªè§£ã€‚
**å¦‚æœä¸æ˜¯**ï¼šé‚£éº¼æˆ‘å€‘æ‰¾åˆ°äº†æ›´å¥½çš„éå¹³è¡Œå››é‚Šå½¢è¨­è¨ˆã€‚

### 4.2 ç¬¬äºŒéšæ®µï¼šæ¯”è¼ƒ

æ¯”è¼ƒä»¥ä¸‹æ–¹æ¡ˆï¼š
- **æ–¹æ¡ˆ A**ï¼šä¸é™åˆ¶ï¼Œè‡ªç”±å„ªåŒ–ï¼ˆå¯èƒ½ä¸æ˜¯å¹³è¡Œå››é‚Šå½¢ï¼‰
- **æ–¹æ¡ˆ B**ï¼šå¼·åˆ¶å¹³è¡Œå››é‚Šå½¢ï¼ˆ$L_2 = L_4, L_1 = L_3$ï¼‰
- **æ–¹æ¡ˆ C**ï¼šå¼·åˆ¶å±¤æ¶æ°´å¹³ä½†ä¸ä¸€å®šå¹³è¡Œå››é‚Šå½¢

çœ‹å“ªå€‹æ–¹æ¡ˆçš„å„²å­˜ç©ºé–“æ›´å¤§ã€‚

---

## 5. å¯¦éš›åŸ·è¡Œï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å„ªåŒ–

### 5.1 ä¿®æ”¹å¾Œçš„ Python ä»£ç¢¼

```python
def objective_general_fourbar(x):
    """
    ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹ï¼ˆä¸å‡è¨­å¹³è¡Œå››é‚Šå½¢ï¼‰

    åƒæ•¸ x = [L1, L2, L3, L4, alpha1, alpha2, beta1, beta2, x_O2, y_O2]

    å…¶ä¸­ï¼š
    - L1 = |O2 O4|ï¼ˆå›ºå®šæ¡¿ï¼‰
    - L2 = |O2 A|ï¼ˆé©…å‹•æ¡¿ï¼‰
    - L3 = |AB|ï¼ˆé€£æ¥æ¡¿/couplerï¼‰
    - L4 = |O4 B|ï¼ˆå¾å‹•æ¡¿ï¼‰
    - alpha1, alpha2: L2 çš„åˆå§‹å’Œæœ€çµ‚è§’åº¦
    - beta1, beta2: L4 çš„åˆå§‹å’Œæœ€çµ‚è§’åº¦
    """
    L1, L2, L3, L4, alpha1, alpha2, beta1, beta2, x_O2, y_O2 = x

    # å›ºå®šé»
    O2 = np.array([x_O2, y_O2])
    O4 = np.array([x_O2, y_O2 + L1])  # å‡è¨­ O4 åœ¨ O2 æ­£ä¸Šæ–¹

    # åˆå§‹ç‹€æ…‹
    alpha1_rad = np.radians(alpha1)
    beta1_rad = np.radians(beta1)

    A_init = O2 + L2 * np.array([np.sin(alpha1_rad), np.cos(alpha1_rad)])
    B_init = O4 + L4 * np.array([np.sin(beta1_rad), np.cos(beta1_rad)])

    # æª¢æŸ¥ |AB| = L3ï¼ˆé–‰åˆæ¢ä»¶ï¼‰
    AB_init = np.linalg.norm(B_init - A_init)
    closure_error_init = abs(AB_init - L3)

    # æœ€çµ‚ç‹€æ…‹
    alpha2_rad = np.radians(alpha2)
    beta2_rad = np.radians(beta2)

    A_final = O2 + L2 * np.array([np.sin(alpha2_rad), np.cos(alpha2_rad)])
    B_final = O4 + L4 * np.array([np.sin(beta2_rad), np.cos(beta2_rad)])

    # æª¢æŸ¥ |AB| = L3ï¼ˆé–‰åˆæ¢ä»¶ï¼‰
    AB_final = np.linalg.norm(B_final - A_final)
    closure_error_final = abs(AB_final - L3)

    # å¦‚æœé–‰åˆèª¤å·®å¤ªå¤§ï¼Œåš´é‡æ‡²ç½°
    if closure_error_init > 0.1 or closure_error_final > 0.1:
        return 10000

    # è¨ˆç®—å„²å­˜ç©ºé–“ï¼ˆè¿‘ä¼¼ï¼‰
    # å‡è¨­å±¤æ¶æ²¿è‘— AB æ–¹å‘ï¼Œå¯¬åº¦ç‚ºæŸå€‹å‡½æ•¸
    shelf_width = L3
    shelf_depth = min(A_init[0], B_init[0]) - 2  # ç°¡åŒ–è¨ˆç®—

    if shelf_depth < 0:
        return 10000

    A_storage = shelf_width * shelf_depth

    # ç›®æ¨™ï¼šæœ€å¤§åŒ–å„²å­˜ç©ºé–“
    return -A_storage

# è®Šæ•¸ç¯„åœï¼š[L1, L2, L3, L4, alpha1, alpha2, beta1, beta2, x_O2, y_O2]
bounds_general = [
    (25, 55),   # L1
    (35, 65),   # L2
    (25, 55),   # L3
    (35, 65),   # L4
    (15, 35),   # alpha1
    (65, 85),   # alpha2
    (15, 35),   # beta1
    (65, 85),   # beta2
    (5, 15),    # x_O2
    (0, 15),    # y_O2
]

# é¡å¤–ç´„æŸï¼šä¸‹é™è·é›¢
def constraint_drop_general(x):
    L1, L2, L3, L4, alpha1, alpha2, beta1, beta2, x_O2, y_O2 = x

    alpha1_rad = np.radians(alpha1)
    alpha2_rad = np.radians(alpha2)

    O2 = np.array([x_O2, y_O2])
    A_init = O2 + L2 * np.array([np.sin(alpha1_rad), np.cos(alpha1_rad)])
    A_final = O2 + L2 * np.array([np.sin(alpha2_rad), np.cos(alpha2_rad)])

    delta_h = A_init[1] - A_final[1]
    return delta_h - 30  # >= 0

# ç´„æŸï¼šæ ¼æ‹‰æ›‰å¤«å®šç†ï¼ˆç¢ºä¿å¯é‹å‹•ï¼‰
def constraint_grashof(x):
    L1, L2, L3, L4 = x[0], x[1], x[2], x[3]

    lengths = sorted([L1, L2, L3, L4])
    s, l = lengths[0], lengths[-1]
    p, q = lengths[1], lengths[2]

    # æ ¼æ‹‰æ›‰å¤«æ¢ä»¶ï¼šs + l <= p + q
    return (p + q) - (s + l)  # >= 0

# åŸ·è¡Œå„ªåŒ–
result_general = differential_evolution(
    objective_general_fourbar,
    bounds_general,
    constraints=[
        {'type': 'ineq', 'fun': constraint_drop_general},
        {'type': 'ineq', 'fun': constraint_grashof},
        # ... å…¶ä»–ç´„æŸ
    ],
    maxiter=1000,
    seed=42,
)

print("ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å„ªåŒ–çµæœï¼š")
L1_gen, L2_gen, L3_gen, L4_gen = result_general.x[:4]
print(f"L1 = {L1_gen:.2f} cm")
print(f"L2 = {L2_gen:.2f} cm")
print(f"L3 = {L3_gen:.2f} cm")
print(f"L4 = {L4_gen:.2f} cm")

# æª¢æŸ¥æ˜¯å¦ç¢°å·§æ˜¯å¹³è¡Œå››é‚Šå½¢
if abs(L2_gen - L4_gen) < 1 and abs(L1_gen - L3_gen) < 1:
    print("âœ“ çµæœæ¥è¿‘å¹³è¡Œå››é‚Šå½¢ï¼")
else:
    print("âœ— çµæœä¸æ˜¯å¹³è¡Œå››é‚Šå½¢")
    print(f"  L2 vs L4: ç›¸å·® {abs(L2_gen - L4_gen):.2f} cm")
    print(f"  L1 vs L3: ç›¸å·® {abs(L1_gen - L3_gen):.2f} cm")
```

### 5.2 å¯èƒ½çš„çµæœ

**æƒ…æ³ A**ï¼šå„ªåŒ–å¾Œ $L_2 \approx L_4$ ä¸” $L_1 \approx L_3$

â†’ èªªæ˜**å¹³è¡Œå››é‚Šå½¢ç¢ºå¯¦æ˜¯æœ€å„ªè§£**ï¼Œæˆ‘å€‘çš„å‡è¨­æ˜¯åˆç†çš„ã€‚

**æƒ…æ³ B**ï¼šå„ªåŒ–å¾Œ $L_2 \neq L_4$ æˆ– $L_1 \neq L_3$

â†’ èªªæ˜**å­˜åœ¨æ›´å¥½çš„éå¹³è¡Œå››é‚Šå½¢è¨­è¨ˆ**ï¼Œæˆ‘å€‘æ‡‰è©²æ¡ç”¨å®ƒã€‚

---

## 6. çµè«–èˆ‡å»ºè­°

### 6.1 æˆ‘çš„éŒ¯èª¤

åœ¨ã€Œæ­¥é©Ÿ1ã€ä¸­ï¼Œæˆ‘**éæ—©åœ°å‡è¨­äº†å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹**ï¼Œé€™æ˜¯ä¸åš´è¬¹çš„ã€‚

**æ‡‰è©²åšçš„**ï¼š
1. å…ˆå¾ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹é–‹å§‹
2. é€šéå„ªåŒ–æˆ–åˆ†æï¼Œç™¼ç¾å¹³è¡Œå››é‚Šå½¢æ˜¯å¦æœ€å„ª
3. ç„¶å¾Œå†æ±ºå®šæ˜¯å¦æ¡ç”¨

### 6.2 ç‚ºä½•é€™å€‹éŒ¯èª¤ä¸è‡´å‘½

é›–ç„¶ä¸åš´è¬¹ï¼Œä½†å¯¦éš›ä¸Šï¼š

1. **å¹³è¡Œå››é‚Šå½¢æ˜¯åˆç†çš„åˆæ­¥å‡è¨­**
   - ä½œç‚ºã€Œæ­¥é©Ÿ1ã€çš„åŸºç¤è¨­è¨ˆ
   - æ˜“æ–¼ç†è§£å’Œè¨ˆç®—
   - å¤§å¤šæ•¸å•†æ¥­ç”¢å“ç¢ºå¯¦ä½¿ç”¨å¹³è¡Œå››é‚Šå½¢

2. **å¾ŒçºŒæœ‰å„ªåŒ–æ­¥é©Ÿ**
   - ã€Œæ­¥é©Ÿ3ã€çš„å„ªåŒ–å¯ä»¥æ¢ç´¢éå¹³è¡Œå››é‚Šå½¢
   - ã€Œå¯¦éš›åŸ·è¡Œã€çš„å¤šæ–¹æ¡ˆæ¯”è¼ƒå¯ä»¥åŒ…å«ä¸€èˆ¬å››é€£æ¡¿

3. **å ±å‘Šä¸­å¯ä»¥èªªæ˜**
   - ã€Œä½œç‚ºç°¡åŒ–ï¼Œé¦–å…ˆè€ƒæ…®å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹ã€
   - ã€Œå¾ŒçºŒå°‡æ¢ç´¢æ›´ä¸€èˆ¬çš„é…ç½®ã€

### 6.3 å»ºè­°çš„ä¿®æ­£æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šä¿ç•™ç¾æœ‰æµç¨‹ï¼Œä½†åŠ ä¸Šèªªæ˜

åœ¨ã€Œæ­¥é©Ÿ1ã€é–‹é ­åŠ ä¸Šï¼š

> **è¨­è¨ˆç­–ç•¥**ï¼šä½œç‚ºåˆæ­¥è¨­è¨ˆï¼Œæˆ‘å€‘é¦–å…ˆè€ƒæ…®**å¹³è¡Œå››é‚Šå½¢å››é€£æ¡¿æ©Ÿæ§‹**ï¼Œ
> ç†ç”±æ˜¯å®ƒå¯ä»¥ä¿è­‰å±¤æ¶ä¿æŒæ°´å¹³ï¼Œä¸”è¨ˆç®—ç°¡å–®ã€‚
> åœ¨å¾ŒçºŒçš„å„ªåŒ–æ­¥é©Ÿä¸­ï¼Œæˆ‘å€‘å°‡æ¢ç´¢æ›´ä¸€èˆ¬çš„å››é€£æ¡¿é…ç½®ï¼Œ
> ä»¥é©—è­‰å¹³è¡Œå››é‚Šå½¢æ˜¯å¦ç¢ºå¯¦æ˜¯æœ€å„ªè§£ã€‚

#### æ–¹æ¡ˆ Bï¼šå¢åŠ ä¸€å€‹ã€Œä¸€èˆ¬å››é€£æ¡¿æ–¹æ¡ˆã€

åœ¨ã€Œå¯¦éš›åŸ·è¡Œã€ä¸­å¢åŠ ç¬¬å…­å€‹æ–¹æ¡ˆï¼š

**æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿ï¼ˆä¸é™åˆ¶å¹³è¡Œï¼‰**
- ä¸å‡è¨­ $L_2 = L_4$
- å…è¨±å±¤æ¶å§¿æ…‹æ”¹è®Š
- å®Œå…¨è‡ªç”±å„ªåŒ–

ç„¶å¾Œæ¯”è¼ƒæ–¹æ¡ˆ F èˆ‡å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆã€‚

#### æ–¹æ¡ˆ Cï¼šå®Œå…¨é‡å¯«ï¼ˆæœ€åš´è¬¹ï¼Œä½†è²»æ™‚ï¼‰

å¾é ­é–‹å§‹ï¼Œä½¿ç”¨ä¸€èˆ¬å››é€£æ¡¿åˆæˆæ³•ã€‚

### 6.4 å°ä½ çš„å ±å‘Šçš„å»ºè­°

**åœ¨å ±å‘Šçš„ã€Œè¨­è¨ˆæ–¹æ³•ã€éƒ¨åˆ†ï¼Œä½ æ‡‰è©²å¯«**ï¼š

> æœ¬è¨­è¨ˆæ¡ç”¨å››é€£æ¡¿æ©Ÿæ§‹ã€‚ç‚ºäº†ç°¡åŒ–åˆæ­¥è¨­è¨ˆï¼Œ
> æˆ‘å€‘é¦–å…ˆè€ƒæ…®**å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹**ï¼ˆ$L_2 = L_4, L_1 = L_3$ï¼‰ï¼Œ
> å…¶å„ªé»æ˜¯å¯ä»¥ä¿è­‰å±¤æ¶ä¿æŒæ°´å¹³å§¿æ…‹ã€‚
>
> ç„¶è€Œï¼Œå¹³è¡Œå››é‚Šå½¢åªæ˜¯å››é€£æ¡¿æ©Ÿæ§‹çš„ä¸€å€‹ç‰¹ä¾‹ã€‚
> åœ¨å¾ŒçºŒçš„å„ªåŒ–éšæ®µï¼Œæˆ‘å€‘ä¹Ÿæ¢ç´¢äº†æ›´ä¸€èˆ¬çš„é…ç½®ï¼Œ
> ä»¥é©—è­‰å¹³è¡Œå››é‚Šå½¢æ˜¯å¦ç‚ºæœ€å„ªè§£ã€‚
>
> çµæœé¡¯ç¤ºï¼š[æ ¹æ“šä½ çš„å„ªåŒ–çµæœå¡«å¯«]
> - è‹¥å„ªåŒ–å¾Œä»æ¥è¿‘å¹³è¡Œå››é‚Šå½¢ï¼šã€Œå„ªåŒ–å¾Œçš„è¨­è¨ˆä»ç„¶æ¥è¿‘å¹³è¡Œå››é‚Šå½¢ï¼Œé©—è­‰äº†åˆæ­¥å‡è¨­çš„åˆç†æ€§ã€‚ã€
> - è‹¥å„ªåŒ–å¾Œä¸æ˜¯å¹³è¡Œå››é‚Šå½¢ï¼šã€Œå„ªåŒ–ç™¼ç¾äº†æ€§èƒ½æ›´å„ªçš„éå¹³è¡Œå››é‚Šå½¢é…ç½®ã€‚ã€

---

## 7. é¡å¤–è¨è«–ï¼šå±¤æ¶æ˜¯å¦å¿…é ˆä¿æŒæ°´å¹³ï¼Ÿ

### 7.1 é¡Œç›®ä¸¦æœªæ˜ç¢ºè¦æ±‚

é¡Œç›®åªèªªï¼š
- ä½¿ç”¨å››é€£æ¡¿æ©Ÿæ§‹
- ä¸‹é™è‡³å°‘ 30 cm

**ä¸¦æœªèªªå±¤æ¶å¿…é ˆæ°´å¹³ï¼**

### 7.2 å…è¨±å‚¾æ–œçš„å„ªç¼ºé»

#### å„ªé»
- âœ… è¨­è¨ˆè‡ªç”±åº¦æ›´å¤§ï¼Œå¯èƒ½æ‰¾åˆ°æ›´å„ªè§£
- âœ… æŸäº›ç‰©å“æ”¾åœ¨å‚¾æ–œå±¤æ¶æ›´ç©©ï¼ˆå¦‚æ›¸æœ¬ï¼‰
- âœ… å¯ä»¥è¨­è¨ˆæˆã€Œè‡ªç„¶ä¸‹æ»‘ã€çš„æ‹¿å–æ–¹å¼

#### ç¼ºé»
- âš ï¸ æ¶²é«”å®¹å™¨ç„¡æ³•æ”¾ç½®
- âš ï¸ è¦–è¦ºä¸Šå¯èƒ½ä¸å¤ ã€Œæ­£å¸¸ã€
- âš ï¸ ç‰©å“å¯èƒ½æ»‘å‹•

### 7.3 å»ºè­°

**å¯¦ç”¨è§€é»**ï¼šå±¤æ¶æ‡‰ç›¡é‡æ¥è¿‘æ°´å¹³ï¼ˆå‚¾æ–œ < 5Â°ï¼‰

**æ•¸å­¸è§€é»**ï¼šä¸æ‡‰é å…ˆé™åˆ¶ï¼Œè®“å„ªåŒ–æ±ºå®š

**æŠ˜è¡·æ–¹æ¡ˆ**ï¼šåœ¨å„ªåŒ–ä¸­åŠ å…¥ã€Œè»Ÿç´„æŸã€

```python
def objective_with_horizontal_preference(x):
    """å„ªåŒ–ç›®æ¨™ï¼šæœ€å¤§åŒ–ç©ºé–“ï¼Œä½†åå¥½æ°´å¹³"""
    pos = calculate_positions(x)

    # è¨ˆç®—å±¤æ¶å‚¾æ–œè§’
    A, B = pos['A_final'], pos['B_final']
    tilt_angle = np.degrees(np.arctan2(B[1] - A[1], B[0] - A[0]))

    # ä¸»ç›®æ¨™ï¼šå„²å­˜ç©ºé–“
    storage_score = pos['A_storage']

    # æ‡²ç½°å‚¾æ–œ
    tilt_penalty = 10 * abs(tilt_angle)  # æ¯å‚¾æ–œ1åº¦æ¸›10åˆ†

    return -(storage_score - tilt_penalty)
```

---

## 8. ç¸½çµ

### ğŸ¯ ä½ çš„è³ªç–‘æ˜¯æ­£ç¢ºçš„

æˆ‘ä¸æ‡‰è©²åœ¨æ²’æœ‰å……åˆ†ç†ç”±çš„æƒ…æ³ä¸‹ï¼Œç›´æ¥å‡è¨­å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹ã€‚

### âœ… æ­£ç¢ºçš„åšæ³•

1. **åˆæ­¥è¨­è¨ˆ**ï¼šå¯ä»¥è€ƒæ…®å¹³è¡Œå››é‚Šå½¢ï¼ˆç°¡åŒ–ï¼‰
2. **å„ªåŒ–éšæ®µ**ï¼šæ¢ç´¢ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹
3. **é©—è­‰æ¯”è¼ƒ**ï¼šç¢ºèªå¹³è¡Œå››é‚Šå½¢æ˜¯å¦æœ€å„ª
4. **å ±å‘Šèªªæ˜**ï¼šæ¸…æ¥šé™³è¿°å‡è¨­å’Œç†ç”±

### ğŸ“ å°ä½ çš„å ±å‘Šçš„å½±éŸ¿

**å¥½æ¶ˆæ¯**ï¼šé€™ä¸æœƒå½±éŸ¿ä½ çš„å ±å‘Šå“è³ªï¼Œåè€Œå¯ä»¥ï¼š

1. **å±•ç¾æ‰¹åˆ¤æ€§æ€ç¶­**
   - åœ¨å ±å‘Šä¸­æå‡ºï¼šã€Œç‚ºä½•é¸æ“‡å¹³è¡Œå››é‚Šå½¢ï¼Ÿã€
   - è¨è«–ï¼šã€Œæ˜¯å¦å­˜åœ¨æ›´å¥½çš„éå¹³è¡Œå››é‚Šå½¢è¨­è¨ˆï¼Ÿã€
   - é€™æœƒè®“å ±å‘Šæ›´æ·±å…¥

2. **å¢åŠ ä¸€å€‹å„ªåŒ–æ–¹æ¡ˆ**
   - æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿ï¼ˆä¸é™åˆ¶å¹³è¡Œï¼‰
   - èˆ‡å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆæ¯”è¼ƒ
   - è­‰æ˜ä½ è€ƒæ…®å¾—æ›´å…¨é¢

3. **æå‡ç†è«–æ·±åº¦**
   - è¨è«–æ©Ÿæ§‹åˆæˆçš„è‡ªç”±åº¦
   - èªªæ˜è¨­è¨ˆå‡è¨­çš„å½±éŸ¿
   - å±•ç¾å·¥ç¨‹åˆ¤æ–·èƒ½åŠ›

---

## 9. ç«‹å³è¡Œå‹•å»ºè­°

### é¸é … Aï¼šä¿æŒç¾æœ‰æ–¹æ³•ï¼ˆæ¨è–¦ï¼Œçœæ™‚ï¼‰

1. ä¿ç•™å¹³è¡Œå››é‚Šå½¢çš„æ­¥é©Ÿ1
2. åœ¨å ±å‘Šä¸­åŠ ä¸Šèªªæ˜ï¼šã€Œä½œç‚ºç°¡åŒ–å‡è¨­ã€
3. åœ¨è¨è«–éƒ¨åˆ†æå‡ºï¼šã€Œæœªä¾†å¯æ¢ç´¢ä¸€èˆ¬å››é€£æ¡¿ã€

**å„ªé»**ï¼šä¸ç”¨é‡æ–°è¨ˆç®—ï¼Œç¯€çœæ™‚é–“
**ç¼ºé»**ï¼šç†è«–ä¸å¤ å®Œç¾

### é¸é … Bï¼šå¢åŠ ä¸€èˆ¬å››é€£æ¡¿æ–¹æ¡ˆï¼ˆæ¨è–¦ï¼ŒåŠ åˆ†ï¼‰

1. åœ¨ã€Œå¯¦éš›åŸ·è¡Œã€çš„ Python ä»£ç¢¼ä¸­
2. å¢åŠ ã€Œæ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿ã€
3. ä¸å‡è¨­ $L_2 = L_4$
4. æ¯”è¼ƒçµæœ

**å„ªé»**ï¼šæ›´åš´è¬¹ï¼Œå±•ç¾æ·±åº¦æ€è€ƒ
**ç¼ºé»**ï¼šéœ€è¦é¡å¤–1-2å°æ™‚åŸ·è¡Œå’Œåˆ†æ

### é¸é … Cï¼šå®Œå…¨é‡å¯«ï¼ˆä¸æ¨è–¦ï¼Œè€—æ™‚ï¼‰

å¾é ­ä½¿ç”¨ä¸€èˆ¬å››é€£æ¡¿åˆæˆæ³•ã€‚

**å„ªé»**ï¼šç†è«–å®Œç¾
**ç¼ºé»**ï¼šè€—æ™‚å¤ªé•·ï¼Œå ±å‘ŠæœŸé™å¯èƒ½ä¸å…è¨±

---

**æˆ‘æ¨è–¦é¸é … B**ï¼šå¢åŠ ä¸€èˆ¬å››é€£æ¡¿æ–¹æ¡ˆã€‚

é€™æ¨£ä½ å¯ä»¥ï¼š
- ä¿ç•™ç¾æœ‰çš„æ‰€æœ‰è¨ˆç®—
- å¢åŠ ä¸€å€‹æ›´åš´è¬¹çš„æ–¹æ¡ˆ
- åœ¨å ±å‘Šä¸­æ¯”è¼ƒå…©ç¨®æ–¹æ³•
- å±•ç¾æ‰¹åˆ¤æ€§æ€è€ƒ

éœ€è¦æˆ‘å¹«ä½ å¯«ã€Œæ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿ã€çš„å®Œæ•´ä»£ç¢¼å—ï¼Ÿ
