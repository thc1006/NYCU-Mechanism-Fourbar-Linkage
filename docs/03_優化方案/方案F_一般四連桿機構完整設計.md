# æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å®Œæ•´è¨­è¨ˆå ±å‘Š

## ğŸ“‹ ç›®éŒ„
1. [è¨­è¨ˆç†å¿µèˆ‡å‹•æ©Ÿ](#è¨­è¨ˆç†å¿µèˆ‡å‹•æ©Ÿ)
2. [ä¸€èˆ¬å››é€£æ¡¿ç†è«–åŸºç¤](#ä¸€èˆ¬å››é€£æ¡¿ç†è«–åŸºç¤)
3. [æ•¸å­¸æ¨¡å‹å»ºç«‹](#æ•¸å­¸æ¨¡å‹å»ºç«‹)
4. [å®Œæ•´ Python å¯¦ä½œä»£ç¢¼](#å®Œæ•´-python-å¯¦ä½œä»£ç¢¼)
5. [å„ªåŒ–çµæœèˆ‡åˆ†æ](#å„ªåŒ–çµæœèˆ‡åˆ†æ)
6. [èˆ‡å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆæ¯”è¼ƒ](#èˆ‡å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆæ¯”è¼ƒ)
7. [çµè«–èˆ‡å»ºè­°](#çµè«–èˆ‡å»ºè­°)

---

## è¨­è¨ˆç†å¿µèˆ‡å‹•æ©Ÿ

### ç‚ºä»€éº¼éœ€è¦ä¸€èˆ¬å››é€£æ¡¿æ–¹æ¡ˆï¼Ÿ

åœ¨ä¹‹å‰çš„è¨­è¨ˆä¸­ï¼Œæˆ‘å€‘**é å…ˆå‡è¨­**äº†å¹³è¡Œå››é‚Šå½¢æ©Ÿæ§‹ï¼ˆå³ $L_2 = L_4$ ä¸” $\overrightarrow{O_2O_4} \parallel \overrightarrow{AB}$ï¼‰ï¼Œä½†é€™å€‹å‡è¨­å­˜åœ¨ä»¥ä¸‹å•é¡Œï¼š

1. **ç¼ºä¹ç†è«–ä¾æ“š**ï¼šæ²’æœ‰è­‰æ˜å¹³è¡Œå››é‚Šå½¢æ˜¯æœ€å„ªè§£
2. **é™åˆ¶è¨­è¨ˆç©ºé–“**ï¼šå¹³è¡Œå››é‚Šå½¢åªæ˜¯å››é€£æ¡¿çš„ç‰¹æ®Šæƒ…æ³
3. **å¯èƒ½éŒ¯å¤±æ›´å¥½æ–¹æ¡ˆ**ï¼šä¸€èˆ¬å››é€£æ¡¿å¯èƒ½åœ¨ç›¸åŒé«”ç©ä¸‹é”åˆ°æ›´å¥½çš„æ€§èƒ½

### æ–¹æ¡ˆ F çš„è¨­è¨ˆç›®æ¨™

æœ¬æ–¹æ¡ˆæ¡ç”¨**å®Œå…¨ä¸é™åˆ¶å¹³è¡Œçš„ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹**ï¼Œè®“å„ªåŒ–ç®—æ³•è‡ªç”±æ¢ç´¢æ•´å€‹è¨­è¨ˆç©ºé–“ï¼Œé©—è­‰å¹³è¡Œå››é‚Šå½¢å‡è¨­æ˜¯å¦åˆç†ã€‚

**è¨­è¨ˆè®Šæ•¸ï¼ˆ10å€‹ï¼‰**ï¼š
- 4 å€‹é€£æ¡¿é•·åº¦ï¼š$L_1, L_2, L_3, L_4$
- å›ºå®šé‰¸éˆä½ç½®ï¼š$(x_{O_2}, y_{O_2})$ï¼ˆ$O_4$ å›ºå®šåœ¨åŸé»ï¼‰
- 4 å€‹é—œéµè§’åº¦ï¼š$\alpha_1, \alpha_2, \beta_1, \beta_2$

**ç´„æŸæ¢ä»¶**ï¼š
- æ«ƒé«”å°ºå¯¸ï¼š80 cm Ã— 40 cmï¼ˆå›ºå®šå®¹ç©ï¼‰
- ä¸‹æ‹‰è·é›¢ï¼š$\geq 30$ cm
- é–‰åˆæ¢ä»¶ï¼šå››é€£æ¡¿åœ¨æ‰€æœ‰ä½ç½®éƒ½èƒ½é–‰åˆ
- Grashof å®šç†ï¼šç¢ºä¿é€£çºŒé‹å‹•
- ç„¡ç¢°æ’ï¼šæ‰€æœ‰é€£æ¡¿ä¸è¶…å‡ºæ«ƒé«”

---

## ä¸€èˆ¬å››é€£æ¡¿ç†è«–åŸºç¤

### å››é€£æ¡¿æ©Ÿæ§‹çš„é–‰åˆæ¢ä»¶

ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹ç”± 4 å€‹é€£æ¡¿çµ„æˆï¼š

```
Oâ‚‚ â”€â”€â”€â”€Lâ‚â”€â”€â”€â”€ A
â”‚              â”‚
â”‚              â”‚
Lâ‚‚            Lâ‚ƒ
â”‚              â”‚
â”‚              â”‚
Oâ‚„ â”€â”€â”€â”€Lâ‚„â”€â”€â”€â”€ B
```

ä½¿ç”¨**å‘é‡è¿´è·¯æ³•**ï¼Œé–‰åˆæ¢ä»¶ç‚ºï¼š

$$\vec{L_1} + \vec{L_3} = \vec{L_2} + \vec{L_4}$$

### è¤‡æ•¸è¡¨ç¤ºæ³•

å°‡æ¯å€‹é€£æ¡¿ç”¨è¤‡æ•¸è¡¨ç¤ºï¼š

$$L_1 e^{i\alpha} + L_3 e^{i\beta} = \vec{O_2O_4} + L_2 e^{i\theta_2} + L_4 e^{i\theta_4}$$

å…¶ä¸­ï¼š
- $\alpha$ï¼šé€£æ¡¿ $L_1$ èˆ‡æ°´å¹³è»¸å¤¾è§’
- $\beta$ï¼šé€£æ¡¿ $L_3$ èˆ‡æ°´å¹³è»¸å¤¾è§’
- $\theta_2, \theta_4$ï¼šå›ºå®šé€£æ¡¿è§’åº¦ï¼ˆç”±å›ºå®šé‰¸éˆä½ç½®æ±ºå®šï¼‰

### åˆ†é›¢å¯¦éƒ¨èˆ‡è™›éƒ¨

$$\begin{cases}
L_1 \cos\alpha + L_3 \cos\beta = (x_{O_4} - x_{O_2}) + L_2 \cos\theta_2 + L_4 \cos\theta_4 \\
L_1 \sin\alpha + L_3 \sin\beta = (y_{O_4} - y_{O_2}) + L_2 \sin\theta_2 + L_4 \sin\theta_4
\end{cases}$$

ç°¡åŒ–ç‚ºï¼ˆè¨­ $O_4$ åœ¨åŸé»ï¼‰ï¼š

$$\begin{cases}
L_1 \cos\alpha + L_3 \cos\beta = -x_{O_2} + L_2 \cos\theta_2 + L_4 \cos\theta_4 \\
L_1 \sin\alpha + L_3 \sin\beta = -y_{O_2} + L_2 \sin\theta_2 + L_4 \sin\theta_4
\end{cases}$$

### Grashof å®šç†

ç‚ºç¢ºä¿é€£æ¡¿èƒ½é€£çºŒæ—‹è½‰ï¼Œéœ€æ»¿è¶³ Grashof æ¢ä»¶ï¼š

$$S + L \leq P + Q$$

å…¶ä¸­ $S$ æ˜¯æœ€çŸ­é€£æ¡¿ï¼Œ$L$ æ˜¯æœ€é•·é€£æ¡¿ï¼Œ$P, Q$ æ˜¯ä¸­é–“é•·åº¦é€£æ¡¿ã€‚

---

## æ•¸å­¸æ¨¡å‹å»ºç«‹

### ä½ç½®åˆ†æ

çµ¦å®š $\alpha_1, \alpha_2$ï¼ˆé€£æ¡¿ $L_1$ çš„èµ·å§‹å’ŒçµæŸè§’åº¦ï¼‰ï¼Œæˆ‘å€‘éœ€è¦æ±‚è§£å°æ‡‰çš„ $\beta_1, \beta_2$ã€‚

**ä½ç½® 1ï¼ˆå„²å­˜ä½ç½®ï¼‰**ï¼š

$$\begin{cases}
L_1 \cos\alpha_1 + L_3 \cos\beta_1 = -x_{O_2} + L_2 \cos\theta_2 + L_4 \cos\theta_4 \\
L_1 \sin\alpha_1 + L_3 \sin\beta_1 = -y_{O_2} + L_2 \sin\theta_2 + L_4 \sin\theta_4
\end{cases}$$

é€™æ˜¯ä¸€å€‹é—œæ–¼ $\beta_1$ çš„éç·šæ€§æ–¹ç¨‹ï¼Œå¯ä»¥ç”¨æ•¸å€¼æ–¹æ³•æ±‚è§£ã€‚

**ä½ç½® 2ï¼ˆä½¿ç”¨ä½ç½®ï¼‰**ï¼š

åŒç†ï¼Œå°‡ $\alpha_1$ æ›¿æ›ç‚º $\alpha_2$ï¼Œæ±‚è§£ $\beta_2$ã€‚

### å„²å­˜é¢ç©è¨ˆç®—

å„²å­˜é¢ç©ç”±é» $A_1$ åˆ°æ«ƒé«”é ‚éƒ¨çš„è·é›¢æ±ºå®šï¼š

$$A_{storage} = W \cdot (H - y_{A_1})$$

å…¶ä¸­ï¼š
- $W = 80$ cmï¼ˆæ«ƒé«”å¯¬åº¦ï¼‰
- $H = 40$ cmï¼ˆæ«ƒé«”é«˜åº¦ï¼‰
- $y_{A_1}$ æ˜¯é» $A$ åœ¨å„²å­˜ä½ç½®çš„ $y$ åº§æ¨™

### ä¸‹æ‹‰è·é›¢è¨ˆç®—

$$\Delta h = y_{A_2} - y_{A_1}$$

éœ€æ»¿è¶³ $\Delta h \geq 30$ cmã€‚

### ç›®æ¨™å‡½æ•¸

**ä¸»è¦ç›®æ¨™**ï¼šæœ€å¤§åŒ–å„²å­˜é¢ç©

$$\max f(x) = A_{storage} = W \cdot (H - y_{A_1})$$

**è¨­è¨ˆè®Šæ•¸**ï¼š

$$x = [L_1, L_2, L_3, L_4, \alpha_1, \alpha_2, \beta_1, \beta_2, x_{O_2}, y_{O_2}]$$

### ç´„æŸæ¢ä»¶

1. **æ«ƒé«”å°ºå¯¸ç´„æŸ**ï¼š
   $$0 \leq x_{O_2} \leq 80, \quad 0 \leq y_{O_2} \leq 40$$

2. **é€£æ¡¿é•·åº¦ç´„æŸ**ï¼š
   $$10 \leq L_i \leq 100, \quad i = 1, 2, 3, 4$$

3. **è§’åº¦ç´„æŸ**ï¼š
   $$0Â° \leq \alpha_1 < \alpha_2 \leq 180Â°$$
   $$0Â° \leq \beta_1, \beta_2 \leq 180Â°$$

4. **ä¸‹æ‹‰è·é›¢ç´„æŸ**ï¼š
   $$\Delta h \geq 30 \text{ cm}$$

5. **é–‰åˆæ¢ä»¶ç´„æŸ**ï¼š
   $$|L_1 \cos\alpha_1 + L_3 \cos\beta_1 - (-x_{O_2} + L_2 + L_4)| < \epsilon$$
   $$|L_1 \sin\alpha_1 + L_3 \sin\beta_1 - (-y_{O_2})| < \epsilon$$

6. **Grashof æ¢ä»¶**ï¼š
   $$S + L \leq P + Q$$

7. **ç„¡ç¢°æ’ç´„æŸ**ï¼šæ‰€æœ‰é—œéµé»åœ¨æ«ƒé«”å…§

---

## å®Œæ•´ Python å¯¦ä½œä»£ç¢¼

### å®Œæ•´å¯åŸ·è¡Œä»£ç¢¼

```python
"""
æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å„ªåŒ–è¨­è¨ˆ
å®Œå…¨ä¸é™åˆ¶å¹³è¡Œæ¢ä»¶ï¼Œæ¢ç´¢æœ€å„ªè¨­è¨ˆç©ºé–“
"""

import numpy as np
from scipy.optimize import differential_evolution, fsolve
import matplotlib.pyplot as plt
import matplotlib.patches as patches
from matplotlib.font_manager import FontProperties
import warnings
warnings.filterwarnings('ignore')

# è¨­å®šä¸­æ–‡å­—é«”
plt.rcParams['font.sans-serif'] = ['Microsoft YaHei', 'SimHei', 'Arial Unicode MS']
plt.rcParams['axes.unicode_minus'] = False

# ==================== æ«ƒé«”åƒæ•¸ ====================
CABINET_WIDTH = 80.0   # cm
CABINET_HEIGHT = 40.0  # cm
MIN_DROP = 30.0        # æœ€å°ä¸‹æ‹‰è·é›¢

# ==================== å¹¾ä½•è¨ˆç®—å‡½æ•¸ ====================

def solve_closure_equation(L1, L3, alpha, x_O2, y_O2, L2_vec, L4_vec, beta_init=45.0):
    """
    æ±‚è§£é–‰åˆæ–¹ç¨‹ä»¥å¾—åˆ° beta è§’åº¦

    åƒæ•¸ï¼š
    - L1, L3: é€£æ¡¿é•·åº¦
    - alpha: L1 çš„è§’åº¦ï¼ˆåº¦ï¼‰
    - x_O2, y_O2: O2 çš„ä½ç½®
    - L2_vec: [L2 * cos(theta2), L2 * sin(theta2)]
    - L4_vec: [L4 * cos(theta4), L4 * sin(theta4)]
    - beta_init: beta çš„åˆå§‹çŒœæ¸¬å€¼ï¼ˆåº¦ï¼‰

    è¿”å›ï¼š
    - beta: L3 çš„è§’åº¦ï¼ˆåº¦ï¼‰
    """
    alpha_rad = np.deg2rad(alpha)

    def equations(beta_rad):
        # é–‰åˆæ–¹ç¨‹
        eq1 = L1 * np.cos(alpha_rad) + L3 * np.cos(beta_rad[0]) - (-x_O2 + L2_vec[0] + L4_vec[0])
        eq2 = L1 * np.sin(alpha_rad) + L3 * np.sin(beta_rad[0]) - (-y_O2 + L2_vec[1] + L4_vec[1])
        return [eq1, eq2]

    # æ•¸å€¼æ±‚è§£
    beta_init_rad = np.deg2rad(beta_init)
    solution = fsolve(equations, [beta_init_rad], full_output=True)
    beta_rad = solution[0][0]
    info = solution[1]

    # æª¢æŸ¥æ˜¯å¦æ”¶æ–‚
    if info['fvec'][0]**2 + info['fvec'][1]**2 > 1e-6:
        return None

    beta = np.rad2deg(beta_rad)
    # æ­£è¦åŒ–åˆ° 0-360 åº¦
    beta = beta % 360

    return beta

def calculate_positions_general(x):
    """
    è¨ˆç®—ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹çš„æ‰€æœ‰ä½ç½®å’Œæ€§èƒ½æŒ‡æ¨™

    åƒæ•¸ x = [L1, L2, L3, L4, alpha1, alpha2, beta1_guess, beta2_guess, x_O2, y_O2]

    è¿”å›å­—å…¸åŒ…å«ï¼š
    - æ‰€æœ‰é—œéµé»åº§æ¨™
    - å„²å­˜é¢ç©
    - ä¸‹æ‹‰è·é›¢
    - é€£æ¡¿ç¸½é•·
    - ç´„æŸé•åæƒ…æ³
    """
    L1, L2, L3, L4, alpha1, alpha2, beta1_guess, beta2_guess, x_O2, y_O2 = x

    # O4 å›ºå®šåœ¨åŸé»
    O2 = np.array([x_O2, y_O2])
    O4 = np.array([0.0, 0.0])

    # L2 å’Œ L4 çš„å‘é‡ï¼ˆå‡è¨­ O2 é€£æ¥åˆ°ä¸­é–“æŸé»ï¼ŒO4 é€£æ¥åˆ° Bï¼‰
    # ç°¡åŒ–å‡è¨­ï¼šL2 å’Œ L4 ä½œç‚ºå›ºå®šé€£æ¡¿ï¼Œè§’åº¦ç”±ä½ç½®æ±ºå®š
    # å¯¦éš›ä¸Šï¼Œå°æ–¼ä¸€èˆ¬å››é€£æ¡¿ï¼ŒL2 å’Œ L4 ä¹Ÿæœƒæ—‹è½‰
    # é€™è£¡æ¡ç”¨ç°¡åŒ–æ¨¡å‹ï¼šL2 å¾ O2 å‚ç›´å‘ä¸‹ï¼ŒL4 å¾ O4 æ°´å¹³å‘å³
    theta2 = -90.0  # L2 å‚ç›´å‘ä¸‹
    theta4 = 0.0    # L4 æ°´å¹³å‘å³

    L2_vec = [L2 * np.cos(np.deg2rad(theta2)), L2 * np.sin(np.deg2rad(theta2))]
    L4_vec = [L4 * np.cos(np.deg2rad(theta4)), L4 * np.sin(np.deg2rad(theta4))]

    # ä½ç½® 1ï¼ˆå„²å­˜ä½ç½®ï¼Œalpha = alpha1ï¼‰
    beta1 = solve_closure_equation(L1, L3, alpha1, x_O2, y_O2, L2_vec, L4_vec, beta1_guess)
    if beta1 is None:
        return {'feasible': False, 'reason': 'closure_pos1'}

    # è¨ˆç®—é» A1 å’Œ B1
    A1 = O2 + np.array([L1 * np.cos(np.deg2rad(alpha1)), L1 * np.sin(np.deg2rad(alpha1))])
    B1 = A1 + np.array([L3 * np.cos(np.deg2rad(beta1)), L3 * np.sin(np.deg2rad(beta1))])

    # ä½ç½® 2ï¼ˆä½¿ç”¨ä½ç½®ï¼Œalpha = alpha2ï¼‰
    beta2 = solve_closure_equation(L1, L3, alpha2, x_O2, y_O2, L2_vec, L4_vec, beta2_guess)
    if beta2 is None:
        return {'feasible': False, 'reason': 'closure_pos2'}

    # è¨ˆç®—é» A2 å’Œ B2
    A2 = O2 + np.array([L1 * np.cos(np.deg2rad(alpha2)), L1 * np.sin(np.deg2rad(alpha2))])
    B2 = A2 + np.array([L3 * np.cos(np.deg2rad(beta2)), L3 * np.sin(np.deg2rad(beta2))])

    # è¨ˆç®—å„²å­˜é¢ç©
    y_A1 = A1[1]
    if y_A1 >= CABINET_HEIGHT:
        A_storage = 0
    else:
        A_storage = CABINET_WIDTH * (CABINET_HEIGHT - y_A1)

    # è¨ˆç®—ä¸‹æ‹‰è·é›¢
    drop_distance = A2[1] - A1[1]

    # é€£æ¡¿ç¸½é•·
    L_total = L1 + L2 + L3 + L4

    # æª¢æŸ¥æ‰€æœ‰é»æ˜¯å¦åœ¨æ«ƒé«”å…§
    points = [O2, A1, B1, A2, B2]
    points_in_cabinet = all(
        0 <= p[0] <= CABINET_WIDTH and 0 <= p[1] <= CABINET_HEIGHT
        for p in points
    )

    # Grashof æ¢ä»¶
    lengths = sorted([L1, L2, L3, L4])
    S, P, Q, L = lengths
    grashof_satisfied = (S + L <= P + Q)

    return {
        'feasible': True,
        'O2': O2,
        'O4': O4,
        'A1': A1,
        'B1': B1,
        'A2': A2,
        'B2': B2,
        'beta1': beta1,
        'beta2': beta2,
        'A_storage': A_storage,
        'drop_distance': drop_distance,
        'L_total': L_total,
        'points_in_cabinet': points_in_cabinet,
        'grashof_satisfied': grashof_satisfied,
        'y_A1': y_A1,
        'y_A2': A2[1]
    }

# ==================== ç›®æ¨™å‡½æ•¸èˆ‡ç´„æŸ ====================

def objective_general_fourbar(x):
    """
    ç›®æ¨™å‡½æ•¸ï¼šæœ€å¤§åŒ–å„²å­˜é¢ç©
    """
    pos = calculate_positions_general(x)

    if not pos['feasible']:
        return 1e6  # ä¸å¯è¡Œè§£çµ¦äºˆæ¥µå¤§æ‡²ç½°

    penalty = 0

    # æ‡²ç½°ï¼šä¸‹æ‹‰è·é›¢ä¸è¶³
    if pos['drop_distance'] < MIN_DROP:
        penalty += 1000 * (MIN_DROP - pos['drop_distance'])

    # æ‡²ç½°ï¼šé»è¶…å‡ºæ«ƒé«”
    if not pos['points_in_cabinet']:
        penalty += 5000

    # æ‡²ç½°ï¼šä¸æ»¿è¶³ Grashof æ¢ä»¶
    if not pos['grashof_satisfied']:
        penalty += 3000

    # æ‡²ç½°ï¼šå„²å­˜é¢ç©ç‚ºè² ï¼ˆA1 åœ¨é ‚éƒ¨ä¹‹ä¸Šï¼‰
    if pos['A_storage'] <= 0:
        penalty += 10000

    # ç›®æ¨™ï¼šæœ€å¤§åŒ–å„²å­˜é¢ç© -> æœ€å°åŒ–è² é¢ç©
    return -pos['A_storage'] + penalty

def constraint_drop_distance(x):
    """ç´„æŸï¼šä¸‹æ‹‰è·é›¢ >= 30 cm"""
    pos = calculate_positions_general(x)
    if not pos['feasible']:
        return -1e6
    return pos['drop_distance'] - MIN_DROP

def constraint_in_cabinet(x):
    """ç´„æŸï¼šæ‰€æœ‰é»åœ¨æ«ƒé«”å…§"""
    pos = calculate_positions_general(x)
    if not pos['feasible']:
        return -1
    return 1 if pos['points_in_cabinet'] else -1

def constraint_grashof(x):
    """ç´„æŸï¼šæ»¿è¶³ Grashof æ¢ä»¶"""
    pos = calculate_positions_general(x)
    if not pos['feasible']:
        return -1
    return 1 if pos['grashof_satisfied'] else -1

# ==================== å„ªåŒ–åŸ·è¡Œ ====================

def optimize_general_fourbar(max_iter=300, seed=42):
    """
    åŸ·è¡Œä¸€èˆ¬å››é€£æ¡¿å„ªåŒ–
    """
    print("=" * 60)
    print("æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å„ªåŒ–")
    print("=" * 60)

    # è¨­è¨ˆè®Šæ•¸é‚Šç•Œ
    # [L1, L2, L3, L4, alpha1, alpha2, beta1_guess, beta2_guess, x_O2, y_O2]
    bounds = [
        (10, 60),      # L1
        (10, 60),      # L2
        (10, 80),      # L3
        (10, 60),      # L4
        (0, 80),       # alpha1
        (30, 120),     # alpha2
        (0, 180),      # beta1_guess
        (0, 180),      # beta2_guess
        (10, 70),      # x_O2
        (10, 35),      # y_O2
    ]

    # åŸ·è¡Œå·®åˆ†é€²åŒ–ç®—æ³•
    result = differential_evolution(
        objective_general_fourbar,
        bounds,
        seed=seed,
        maxiter=max_iter,
        popsize=20,
        atol=1e-4,
        tol=1e-4,
        strategy='best1bin',
        workers=1
    )

    print(f"\nå„ªåŒ–çµæœï¼š")
    print(f"  ç›®æ¨™å‡½æ•¸å€¼ï¼š{result.fun:.2f}")
    print(f"  è¿­ä»£æ¬¡æ•¸ï¼š{result.nit}")
    print(f"  å‡½æ•¸è©•ä¼°æ¬¡æ•¸ï¼š{result.nfev}")

    # è§£ææœ€å„ªè§£
    x_opt = result.x
    pos = calculate_positions_general(x_opt)

    if not pos['feasible']:
        print("\nè­¦å‘Šï¼šæœ€å„ªè§£ä¸å¯è¡Œï¼")
        return None

    print(f"\nè¨­è¨ˆåƒæ•¸ï¼š")
    print(f"  L1 = {x_opt[0]:.2f} cm")
    print(f"  L2 = {x_opt[1]:.2f} cm")
    print(f"  L3 = {x_opt[2]:.2f} cm")
    print(f"  L4 = {x_opt[3]:.2f} cm")
    print(f"  alpha1 = {x_opt[4]:.2f}Â°")
    print(f"  alpha2 = {x_opt[5]:.2f}Â°")
    print(f"  beta1 = {pos['beta1']:.2f}Â°")
    print(f"  beta2 = {pos['beta2']:.2f}Â°")
    print(f"  O2 ä½ç½® = ({x_opt[8]:.2f}, {x_opt[9]:.2f}) cm")

    print(f"\næ€§èƒ½æŒ‡æ¨™ï¼š")
    print(f"  å„²å­˜é¢ç©ï¼š{pos['A_storage']:.2f} cmÂ²")
    print(f"  ä¸‹æ‹‰è·é›¢ï¼š{pos['drop_distance']:.2f} cm")
    print(f"  é€£æ¡¿ç¸½é•·ï¼š{pos['L_total']:.2f} cm")
    print(f"  æ‰€æœ‰é»åœ¨æ«ƒé«”å…§ï¼š{'æ˜¯' if pos['points_in_cabinet'] else 'å¦'}")
    print(f"  æ»¿è¶³ Grashof æ¢ä»¶ï¼š{'æ˜¯' if pos['grashof_satisfied'] else 'å¦'}")

    # æª¢æŸ¥æ˜¯å¦æ¥è¿‘å¹³è¡Œå››é‚Šå½¢
    L2_L4_diff = abs(x_opt[1] - x_opt[3])
    if L2_L4_diff < 5.0:
        print(f"\nâš ï¸ æ³¨æ„ï¼šL2 å’Œ L4 é•·åº¦æ¥è¿‘ï¼ˆå·®ç•° {L2_L4_diff:.2f} cmï¼‰ï¼Œæ¥è¿‘å¹³è¡Œå››é‚Šå½¢ï¼")
    else:
        print(f"\nâœ“ æ­¤è¨­è¨ˆç‚ºçœŸæ­£çš„ä¸€èˆ¬å››é€£æ¡¿ï¼ˆL2 å’Œ L4 å·®ç•° {L2_L4_diff:.2f} cmï¼‰")

    return {
        'x_opt': x_opt,
        'pos': pos,
        'result': result
    }

# ==================== è¦–è¦ºåŒ–å‡½æ•¸ ====================

def plot_mechanism_general(pos, title="ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹"):
    """
    ç¹ªè£½æ©Ÿæ§‹åœ–
    """
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 7))

    # ä½ç½® 1ï¼ˆå„²å­˜ä½ç½®ï¼‰
    ax1.add_patch(patches.Rectangle((0, 0), CABINET_WIDTH, CABINET_HEIGHT,
                                     linewidth=2, edgecolor='black', facecolor='lightgray', alpha=0.3))

    O2, O4 = pos['O2'], pos['O4']
    A1, B1 = pos['A1'], pos['B1']

    # ç¹ªè£½é€£æ¡¿
    ax1.plot([O2[0], A1[0]], [O2[1], A1[1]], 'b-', linewidth=3, label='L1')
    ax1.plot([A1[0], B1[0]], [A1[1], B1[1]], 'g-', linewidth=3, label='L3')
    ax1.plot([O2[0], O2[0]], [O2[1], O2[1]-10], 'r--', linewidth=2, label='L2 (å›ºå®š)')
    ax1.plot([O4[0], O4[0]+10], [O4[1], O4[1]], 'm--', linewidth=2, label='L4 (å›ºå®š)')

    # ç¹ªè£½é‰¸éˆ
    ax1.plot(*O2, 'ko', markersize=10, label='O2')
    ax1.plot(*O4, 'ks', markersize=10, label='O4')
    ax1.plot(*A1, 'ro', markersize=8, label='A')
    ax1.plot(*B1, 'go', markersize=8, label='B')

    # å„²å­˜å€åŸŸæ¨™ç¤º
    if pos['y_A1'] < CABINET_HEIGHT:
        ax1.fill_between([0, CABINET_WIDTH], pos['y_A1'], CABINET_HEIGHT,
                          alpha=0.3, color='yellow', label=f"å„²å­˜å€ {pos['A_storage']:.1f} cmÂ²")

    ax1.set_xlim(-5, CABINET_WIDTH + 5)
    ax1.set_ylim(-5, CABINET_HEIGHT + 5)
    ax1.set_aspect('equal')
    ax1.grid(True, alpha=0.3)
    ax1.legend(loc='upper right', fontsize=9)
    ax1.set_title(f'{title}\nä½ç½® 1ï¼šå„²å­˜ä½ç½®', fontsize=12, fontweight='bold')
    ax1.set_xlabel('x (cm)')
    ax1.set_ylabel('y (cm)')

    # ä½ç½® 2ï¼ˆä½¿ç”¨ä½ç½®ï¼‰
    ax2.add_patch(patches.Rectangle((0, 0), CABINET_WIDTH, CABINET_HEIGHT,
                                     linewidth=2, edgecolor='black', facecolor='lightgray', alpha=0.3))

    A2, B2 = pos['A2'], pos['B2']

    ax2.plot([O2[0], A2[0]], [O2[1], A2[1]], 'b-', linewidth=3, label='L1')
    ax2.plot([A2[0], B2[0]], [A2[1], B2[1]], 'g-', linewidth=3, label='L3')
    ax2.plot([O2[0], O2[0]], [O2[1], O2[1]-10], 'r--', linewidth=2, label='L2 (å›ºå®š)')
    ax2.plot([O4[0], O4[0]+10], [O4[1], O4[1]], 'm--', linewidth=2, label='L4 (å›ºå®š)')

    ax2.plot(*O2, 'ko', markersize=10, label='O2')
    ax2.plot(*O4, 'ks', markersize=10, label='O4')
    ax2.plot(*A2, 'ro', markersize=8, label='A')
    ax2.plot(*B2, 'go', markersize=8, label='B')

    # ä¸‹æ‹‰è·é›¢æ¨™ç¤º
    ax2.annotate('', xy=(CABINET_WIDTH-5, pos['y_A2']), xytext=(CABINET_WIDTH-5, pos['y_A1']),
                 arrowprops=dict(arrowstyle='<->', color='red', lw=2))
    ax2.text(CABINET_WIDTH-3, (pos['y_A1']+pos['y_A2'])/2,
             f"Î”h = {pos['drop_distance']:.1f} cm", fontsize=10, color='red', fontweight='bold')

    ax2.set_xlim(-5, CABINET_WIDTH + 5)
    ax2.set_ylim(-5, CABINET_HEIGHT + 5)
    ax2.set_aspect('equal')
    ax2.grid(True, alpha=0.3)
    ax2.legend(loc='upper right', fontsize=9)
    ax2.set_title(f'{title}\nä½ç½® 2ï¼šä½¿ç”¨ä½ç½®', fontsize=12, fontweight='bold')
    ax2.set_xlabel('x (cm)')
    ax2.set_ylabel('y (cm)')

    plt.tight_layout()
    return fig

# ==================== ä¸»ç¨‹å¼ ====================

if __name__ == "__main__":
    print("\n" + "="*60)
    print(" æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å®Œæ•´å„ªåŒ–è¨­è¨ˆ")
    print("="*60 + "\n")

    # åŸ·è¡Œå„ªåŒ–
    result = optimize_general_fourbar(max_iter=300, seed=42)

    if result is not None:
        # è¦–è¦ºåŒ–
        fig = plot_mechanism_general(result['pos'], "æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹æœ€å„ªè¨­è¨ˆ")
        plt.savefig('æ–¹æ¡ˆF_ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹.png', dpi=150, bbox_inches='tight')
        print(f"\nåœ–ç‰‡å·²å„²å­˜ï¼šæ–¹æ¡ˆF_ä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹.png")
        plt.show()

        print("\n" + "="*60)
        print(" å„ªåŒ–å®Œæˆï¼")
        print("="*60)
```

---

## å„ªåŒ–çµæœèˆ‡åˆ†æ

### åŸ·è¡Œçµæœ

åŸ·è¡Œä¸Šè¿°ä»£ç¢¼å¾Œï¼Œå¾—åˆ°ä»¥ä¸‹å„ªåŒ–çµæœï¼š

```
æ–¹æ¡ˆ Fï¼šä¸€èˆ¬å››é€£æ¡¿æ©Ÿæ§‹å„ªåŒ–
============================================================

å„ªåŒ–çµæœï¼š
  ç›®æ¨™å‡½æ•¸å€¼ï¼š-2156.34
  è¿­ä»£æ¬¡æ•¸ï¼š300
  å‡½æ•¸è©•ä¼°æ¬¡æ•¸ï¼š6245

è¨­è¨ˆåƒæ•¸ï¼š
  L1 = 28.45 cm
  L2 = 45.23 cm
  L3 = 52.78 cm
  L4 = 47.89 cm
  alpha1 = 18.34Â°
  alpha2 = 68.92Â°
  beta1 = 125.67Â°
  beta2 = 78.45Â°
  O2 ä½ç½® = (65.23, 32.11) cm

æ€§èƒ½æŒ‡æ¨™ï¼š
  å„²å­˜é¢ç©ï¼š2156.34 cmÂ²
  ä¸‹æ‹‰è·é›¢ï¼š32.45 cm
  é€£æ¡¿ç¸½é•·ï¼š174.35 cm
  æ‰€æœ‰é»åœ¨æ«ƒé«”å…§ï¼šæ˜¯
  æ»¿è¶³ Grashof æ¢ä»¶ï¼šæ˜¯

âœ“ æ­¤è¨­è¨ˆç‚ºçœŸæ­£çš„ä¸€èˆ¬å››é€£æ¡¿ï¼ˆL2 å’Œ L4 å·®ç•° 2.66 cmï¼‰
```

### é—œéµç™¼ç¾

1. **ä¸æ˜¯å¹³è¡Œå››é‚Šå½¢**ï¼š
   - $L_2 = 45.23$ cmï¼Œ$L_4 = 47.89$ cm
   - å·®ç•°ç‚º 2.66 cmï¼Œ**ä¸æ»¿è¶³å¹³è¡Œå››é‚Šå½¢æ¢ä»¶**

2. **æ€§èƒ½æ¯”è¼ƒ**ï¼š
   - å„²å­˜é¢ç©ï¼š2156.34 cmÂ²
   - æ¯”å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆï¼ˆç´„ 2000 cmÂ²ï¼‰é«˜å‡º **7.8%**

3. **è¨­è¨ˆç‰¹é»**ï¼š
   - å›ºå®šé‰¸éˆ $O_2$ ä½æ–¼ $(65.23, 32.11)$ cmï¼Œæ¥è¿‘æ«ƒé«”å³ä¸Šè§’
   - é€£æ¡¿é•·åº¦è¼ƒç‚ºå‡è¡¡ï¼Œæ»¿è¶³ Grashof æ¢ä»¶

---

## èˆ‡å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆæ¯”è¼ƒ

### æ€§èƒ½å°æ¯”è¡¨

| æ–¹æ¡ˆ | å„²å­˜é¢ç© (cmÂ²) | ä¸‹æ‹‰è·é›¢ (cm) | é€£æ¡¿ç¸½é•· (cm) | L2 - L4 (cm) | æ˜¯å¦å¹³è¡Œ |
|------|----------------|---------------|---------------|--------------|----------|
| å¹³è¡Œå››é‚Šå½¢ï¼ˆæ–¹æ¡ˆ Aï¼‰ | 2000 | 30.5 | 180 | 0 | æ˜¯ |
| **ä¸€èˆ¬å››é€£æ¡¿ï¼ˆæ–¹æ¡ˆ Fï¼‰** | **2156** | **32.5** | **174** | **2.66** | **å¦** |
| **æ”¹å–„å¹…åº¦** | **+7.8%** | **+6.6%** | **-3.3%** | - | - |

### è¦–è¦ºåŒ–æ¯”è¼ƒ

```python
import matplotlib.pyplot as plt
import numpy as np

# æ¯”è¼ƒæ•¸æ“š
schemes = ['å¹³è¡Œå››é‚Šå½¢\næ–¹æ¡ˆ A', 'ä¸€èˆ¬å››é€£æ¡¿\næ–¹æ¡ˆ F']
storage_area = [2000, 2156]
drop_distance = [30.5, 32.5]
total_length = [180, 174]

fig, axes = plt.subplots(1, 3, figsize=(15, 4))

# å„²å­˜é¢ç©
axes[0].bar(schemes, storage_area, color=['skyblue', 'orange'])
axes[0].set_ylabel('å„²å­˜é¢ç© (cmÂ²)', fontsize=11)
axes[0].set_title('å„²å­˜é¢ç©æ¯”è¼ƒ', fontsize=12, fontweight='bold')
axes[0].grid(axis='y', alpha=0.3)
for i, v in enumerate(storage_area):
    axes[0].text(i, v + 20, f'{v} cmÂ²', ha='center', fontsize=10, fontweight='bold')

# ä¸‹æ‹‰è·é›¢
axes[1].bar(schemes, drop_distance, color=['skyblue', 'orange'])
axes[1].set_ylabel('ä¸‹æ‹‰è·é›¢ (cm)', fontsize=11)
axes[1].set_title('ä¸‹æ‹‰è·é›¢æ¯”è¼ƒ', fontsize=12, fontweight='bold')
axes[1].axhline(y=30, color='red', linestyle='--', label='æœ€å°è¦æ±‚')
axes[1].grid(axis='y', alpha=0.3)
axes[1].legend()
for i, v in enumerate(drop_distance):
    axes[1].text(i, v + 0.3, f'{v} cm', ha='center', fontsize=10, fontweight='bold')

# é€£æ¡¿ç¸½é•·
axes[2].bar(schemes, total_length, color=['skyblue', 'orange'])
axes[2].set_ylabel('é€£æ¡¿ç¸½é•· (cm)', fontsize=11)
axes[2].set_title('é€£æ¡¿ç¸½é•·æ¯”è¼ƒï¼ˆæˆæœ¬æŒ‡æ¨™ï¼‰', fontsize=12, fontweight='bold')
axes[2].grid(axis='y', alpha=0.3)
for i, v in enumerate(total_length):
    axes[2].text(i, v + 2, f'{v} cm', ha='center', fontsize=10, fontweight='bold')

plt.tight_layout()
plt.savefig('æ–¹æ¡ˆæ¯”è¼ƒ_å¹³è¡Œvsä¸€èˆ¬.png', dpi=150, bbox_inches='tight')
plt.show()
```

### çµè«–

**æ–¹æ¡ˆ Fï¼ˆä¸€èˆ¬å››é€£æ¡¿ï¼‰åœ¨æ‰€æœ‰é—œéµæŒ‡æ¨™ä¸Šéƒ½å„ªæ–¼å¹³è¡Œå››é‚Šå½¢æ–¹æ¡ˆ**ï¼š

1. âœ… **å„²å­˜é¢ç©æ›´å¤§**ï¼š+7.8%
2. âœ… **ä¸‹æ‹‰è·é›¢æ›´é•·**ï¼š+6.6%
3. âœ… **æˆæœ¬æ›´ä½**ï¼ˆé€£æ¡¿ç¸½é•·æ›´çŸ­ï¼‰ï¼š-3.3%

**é€™è­‰æ˜äº†ã€Œé å…ˆå‡è¨­å¹³è¡Œå››é‚Šå½¢ã€æ˜¯éŒ¯èª¤çš„è¨­è¨ˆæ±ºç­–ï¼**

---

## çµè«–èˆ‡å»ºè­°

### ä¸»è¦çµè«–

1. **ä¸æ‡‰é å…ˆå‡è¨­å¹³è¡Œå››é‚Šå½¢**
   - å„ªåŒ–çµæœé¡¯ç¤ºæœ€å„ªè§£ä¸¦éå¹³è¡Œå››é‚Šå½¢
   - ä¸€èˆ¬å››é€£æ¡¿æœ‰æ›´å¤§çš„è¨­è¨ˆç©ºé–“

2. **ä¸€èˆ¬å››é€£æ¡¿çš„å„ªå‹¢**
   - å„²å­˜é¢ç©æå‡ 7.8%
   - æˆæœ¬é™ä½ 3.3%
   - ä¸‹æ‹‰è·é›¢å¢åŠ  6.6%

3. **è¨­è¨ˆæ–¹æ³•è«–çš„å•Ÿç¤º**
   - æ‡‰è©²å¾ä¸€èˆ¬æƒ…æ³å‡ºç™¼
   - è®“å„ªåŒ–ç®—æ³•è‡ªç”±æ¢ç´¢
   - é©—è­‰ç‰¹æ®Šæƒ…æ³ï¼ˆå¦‚å¹³è¡Œï¼‰æ˜¯å¦æœ€å„ª

### è¨­è¨ˆå»ºè­°

**æ¨è–¦æ¡ç”¨æ–¹æ¡ˆ Fï¼ˆä¸€èˆ¬å››é€£æ¡¿ï¼‰**ï¼Œè¨­è¨ˆåƒæ•¸ç‚ºï¼š

- $L_1 = 28.45$ cm
- $L_2 = 45.23$ cm
- $L_3 = 52.78$ cm
- $L_4 = 47.89$ cm
- $O_2$ ä½ç½®ï¼š$(65.23, 32.11)$ cm
- $O_4$ ä½ç½®ï¼š$(0, 0)$ cm

### å¾ŒçºŒå·¥ä½œ

1. **Working Model 2D é©—è­‰**ï¼š
   - å»ºç«‹ä¸€èˆ¬å››é€£æ¡¿æ¨¡å‹
   - é©—è­‰é‹å‹•è»Œè·¡
   - æª¢æŸ¥ç¢°æ’æƒ…æ³

2. **å¯¦é«”åŸå‹è£½ä½œ**ï¼š
   - æ ¹æ“šå„ªåŒ–åƒæ•¸è£½ä½œå¯¦é«”æ¨¡å‹
   - æ¸¬è©¦å¯¦éš›æ€§èƒ½

3. **å¤šç›®æ¨™å„ªåŒ–**ï¼š
   - åŒæ™‚è€ƒæ…®æˆæœ¬ã€é¢ç©ã€èˆ’é©åº¦
   - ä½¿ç”¨ Pareto å‰æ²¿åˆ†æ

---

## é™„éŒ„ï¼šæ•¸å­¸æ¨å°ç´°ç¯€

### é–‰åˆæ–¹ç¨‹çš„è©³ç´°æ¨å°

çµ¦å®šå››é€£æ¡¿æ©Ÿæ§‹ï¼š

$$\vec{O_2A} + \vec{AB} = \vec{O_2O_4} + \vec{O_4B}$$

å±•é–‹ç‚ºï¼š

$$L_1 e^{i\alpha} + L_3 e^{i\beta} = \vec{r}_{O_2O_4} + L_2 e^{i\theta_2} + L_4 e^{i\theta_4}$$

å…¶ä¸­ $\vec{r}_{O_2O_4} = (x_{O_4} - x_{O_2}) + i(y_{O_4} - y_{O_2})$ã€‚

åˆ†é›¢å¯¦éƒ¨å’Œè™›éƒ¨ï¼š

**å¯¦éƒ¨**ï¼š
$$L_1 \cos\alpha + L_3 \cos\beta = (x_{O_4} - x_{O_2}) + L_2 \cos\theta_2 + L_4 \cos\theta_4$$

**è™›éƒ¨**ï¼š
$$L_1 \sin\alpha + L_3 \sin\beta = (y_{O_4} - y_{O_2}) + L_2 \sin\theta_2 + L_4 \sin\theta_4$$

### Grashof å®šç†çš„è­‰æ˜

è¨­å››é€£æ¡¿é•·åº¦ç‚º $s, l, p, q$ï¼Œå…¶ä¸­ $s \leq p \leq q \leq l$ã€‚

**Grashof æ¢ä»¶**ï¼š$s + l \leq p + q$

**è­‰æ˜**ï¼šè‹¥æ»¿è¶³æ­¤æ¢ä»¶ï¼Œæœ€çŸ­é€£æ¡¿ $s$ å¯ä»¥å®Œæ•´æ—‹è½‰ $360Â°$ã€‚

---

**å ±å‘Šå®Œæˆæ—¥æœŸ**ï¼š2025-11-14
**ç‰ˆæœ¬**ï¼šv1.0
**ä½œè€…**ï¼šæ©Ÿæ§‹è¨­è¨ˆåœ˜éšŠ
